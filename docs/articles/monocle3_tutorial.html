<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tutorial: countsplitting and Monocle3 • countsplit</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Tutorial: countsplitting and Monocle3">
<meta property="og:description" content="countsplit">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">countsplit</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/countsplit_tutorial.html">Getting started</a>
</li>
<li>
  <a href="../articles/scran_tutorial.html">Tutorial with scran</a>
</li>
<li>
  <a href="../articles/seurat_tutorial.html">Tutorial with Seurat</a>
</li>
<li>
  <a href="../articles/monocle3_tutorial.html">Tutorial with monocle3</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/anna-neufeld/countsplit/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Tutorial: countsplitting and Monocle3</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/anna-neufeld/countsplit/blob/HEAD/vignettes/monocle3_tutorial.Rmd" class="external-link"><code>vignettes/monocle3_tutorial.Rmd</code></a></small>
      <div class="hidden name"><code>monocle3_tutorial.Rmd</code></div>

    </div>

    
    
<p>Before using this tutorial, we recommend that you read through our ``introduction to count splitting” tutorial to understand our method in a simple package with simulated data.</p>
<p>For this tutorial, we reproduce the Monocle3 <a href="https://cole-trapnell-lab.github.io/monocle3/docs/trajectories/" class="external-link">vignette</a>, but we apply count splitting. The takeaway is that, on this data with a true trajectory and true signal, count splitting does not really change the conclusions.</p>
<div class="section level2">
<h2 id="install-monocle3">Install Monocle3<a class="anchor" aria-label="anchor" href="#install-monocle3"></a>
</h2>
<p>If you don’t already have <code>Monocle3</code>, you will need to install it. Please visit <a href="https://cole-trapnell-lab.github.io/monocle3/docs/installation/" class="external-link">this link</a> for installation details. As <code>Monocle3</code> is in Beta, there may be some trouble shooting involved.</p>
<p>Next, you should load the package, along with others that we will use in this tutorial.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">monocle3</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/anna-neufeld/countsplit" class="external-link">countsplit</a></span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="load-the-data">Load the data<a class="anchor" aria-label="anchor" href="#load-the-data"></a>
</h2>
<p>We do this in the same way as in the Monocle3 tutorial. The key step is constructing the object.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">expression_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/connections.html" class="external-link">url</a></span><span class="op">(</span><span class="st">"https://depts.washington.edu:/trapnell-lab/software/monocle3/celegans/data/packer_embryo_expression.rds"</span><span class="op">)</span><span class="op">)</span>
<span class="va">cell_metadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/connections.html" class="external-link">url</a></span><span class="op">(</span><span class="st">"https://depts.washington.edu:/trapnell-lab/software/monocle3/celegans/data/packer_embryo_colData.rds"</span><span class="op">)</span><span class="op">)</span>
<span class="va">gene_annotation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/connections.html" class="external-link">url</a></span><span class="op">(</span><span class="st">"https://depts.washington.edu:/trapnell-lab/software/monocle3/celegans/data/packer_embryo_rowData.rds"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>But we now want to do count splitting! We do this on the expression matrix only. We take the transpose just to be consistent with out paper, where we want to have cells in the rows and genes in the columns.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">epsilon</span><span class="op">=</span><span class="fl">0.5</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
<span class="va">Xtrain</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">expression_matrix</span>,<span class="fl">2</span>,<span class="kw">function</span><span class="op">(</span><span class="va">u</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span>n<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">u</span><span class="op">)</span>, size<span class="op">=</span><span class="va">u</span>, p<span class="op">=</span><span class="va">epsilon</span><span class="op">)</span><span class="op">)</span>
<span class="va">Xtest</span> <span class="op">&lt;-</span> <span class="va">expression_matrix</span><span class="op">-</span><span class="va">Xtrain</span>
<span class="va">cds_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/monocle3/man/new_cell_data_set.html" class="external-link">new_cell_data_set</a></span><span class="op">(</span><span class="va">Xtrain</span>,
                         cell_metadata <span class="op">=</span> <span class="va">cell_metadata</span>,
                         gene_metadata <span class="op">=</span> <span class="va">gene_annotation</span><span class="op">)</span></code></pre></div>
<p>Now we want to follow the preprocessing and pseudotime steps from the Monocle3 tutorial to come up with pseudotime estiamtes.</p>
<p>Ok! Preprocessing! Using the same steps as the tutorial.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cds_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/monocle3/man/preprocess_cds.html" class="external-link">preprocess_cds</a></span><span class="op">(</span><span class="va">cds_train</span>, num_dim <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>
<span class="va">cds_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/monocle3/man/align_cds.html" class="external-link">align_cds</a></span><span class="op">(</span><span class="va">cds_train</span>, alignment_group <span class="op">=</span> <span class="st">"batch"</span>, residual_model_formula_str <span class="op">=</span> <span class="st">"~ bg.300.loading + bg.400.loading + bg.500.1.loading + bg.500.2.loading + bg.r17.loading + bg.b01.loading + bg.b02.loading"</span><span class="op">)</span></code></pre></div>
<p>We see that in few dimensions, the cells cluster really nice by their true differentiation day. So we know that we are doing something reasonable even though we only used the training set.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cds_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/monocle3/man/reduce_dimension.html" class="external-link">reduce_dimension</a></span><span class="op">(</span><span class="va">cds_train</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/monocle3/man/plot_cells.html" class="external-link">plot_cells</a></span><span class="op">(</span><span class="va">cds_train</span>, label_groups_by_cluster<span class="op">=</span><span class="cn">FALSE</span>,  color_cells_by <span class="op">=</span> <span class="st">"cell.type"</span><span class="op">)</span></code></pre></div>
<p><img src="monocle3_tutorial_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>The one difference we are using is that we are saying NO partition. Because we want one single branch for simplicity in our regression analysis. Sorry lol.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cds_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/monocle3/man/cluster_cells.html" class="external-link">cluster_cells</a></span><span class="op">(</span><span class="va">cds_train</span><span class="op">)</span>
<span class="va">cds_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/monocle3/man/learn_graph.html" class="external-link">learn_graph</a></span><span class="op">(</span><span class="va">cds_train</span>, use_partition<span class="op">=</span><span class="cn">F</span><span class="op">)</span></code></pre></div>
<pre><code>## 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |======================================================================| 100%</code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/monocle3/man/plot_cells.html" class="external-link">plot_cells</a></span><span class="op">(</span><span class="va">cds_train</span>,
           color_cells_by <span class="op">=</span> <span class="st">"cell.type"</span>,
           label_groups_by_cluster<span class="op">=</span><span class="cn">FALSE</span>,
           label_leaves<span class="op">=</span><span class="cn">FALSE</span>,
           label_branch_points<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p><img src="monocle3_tutorial_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>We are required to specify a starting cell. Since we know that we want the starting point of pseudotime to be on day0, we will use a day0 cell as the start.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">get_earliest_principal_node</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">cds</span>, <span class="va">time_bin</span><span class="op">=</span><span class="st">"130-170"</span><span class="op">)</span><span class="op">{</span>
  <span class="va">cell_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu">colData</span><span class="op">(</span><span class="va">cds</span><span class="op">)</span><span class="op">[</span>, <span class="st">"embryo.time.bin"</span><span class="op">]</span> <span class="op">==</span> <span class="va">time_bin</span><span class="op">)</span>
  
  <span class="va">closest_vertex</span> <span class="op">&lt;-</span>
  <span class="va">cds</span><span class="op">@</span><span class="va">principal_graph_aux</span><span class="op">[[</span><span class="st">"UMAP"</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">pr_graph_cell_proj_closest_vertex</span>
  <span class="va">closest_vertex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">closest_vertex</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">cds</span><span class="op">)</span>, <span class="op">]</span><span class="op">)</span>
  <span class="va">root_pr_nodes</span> <span class="op">&lt;-</span>
  <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/V.html" class="external-link">V</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/monocle3/man/principal_graph.html" class="external-link">principal_graph</a></span><span class="op">(</span><span class="va">cds</span><span class="op">)</span><span class="op">[[</span><span class="st">"UMAP"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">$</span><span class="va">name</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span>
  <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">closest_vertex</span><span class="op">[</span><span class="va">cell_ids</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
  
  <span class="va">root_pr_nodes</span>
<span class="op">}</span>
<span class="va">cds_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/monocle3/man/order_cells.html" class="external-link">order_cells</a></span><span class="op">(</span><span class="va">cds_train</span>, root_pr_nodes<span class="op">=</span><span class="fu">get_earliest_principal_node</span><span class="op">(</span><span class="va">cds_train</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/monocle3/man/plot_cells.html" class="external-link">plot_cells</a></span><span class="op">(</span><span class="va">cds_train</span>,
           color_cells_by <span class="op">=</span> <span class="st">"pseudotime"</span>,
           label_cell_groups<span class="op">=</span><span class="cn">FALSE</span>,
           label_leaves<span class="op">=</span><span class="cn">FALSE</span>,
           label_branch_points<span class="op">=</span><span class="cn">FALSE</span>,
           graph_label_size<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span></code></pre></div>
<p><img src="monocle3_tutorial_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>Now we are going to use Monocle3 to study differential expression along pseudotime! Using the same steps as in their tutorial! But the difference is that we will use the TEST set for fitting the models.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cds_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/monocle3/man/new_cell_data_set.html" class="external-link">new_cell_data_set</a></span><span class="op">(</span><span class="va">Xtest</span>,
    gene_metadata <span class="op">=</span> <span class="va">gene_annotation</span>,
    cell_metadata<span class="op">=</span><span class="fu">colData</span><span class="op">(</span><span class="va">cds_train</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>We need to add the training set pseudotime to the cds_test metadata.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">colData</span><span class="op">(</span><span class="va">cds_test</span><span class="op">)</span><span class="op">$</span><span class="va">pseudotime_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/monocle3/man/pseudotime.html" class="external-link">pseudotime</a></span><span class="op">(</span><span class="va">cds_train</span><span class="op">)</span></code></pre></div>
<p>We now skip to the section “finding genes that change as a function of pseudotime.”</p>
<p>To save some time, let’s only use a random subset of genes. Maybe actually we should pick high var genes?</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ciliated_genes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"che-1"</span>,
                    <span class="st">"hlh-17"</span>,
                    <span class="st">"nhr-6"</span>,
                    <span class="st">"dmd-6"</span>,
                    <span class="st">"ceh-36"</span>,
                    <span class="st">"ham-1"</span><span class="op">)</span>
<span class="va">cds_test_subset</span> <span class="op">&lt;-</span> <span class="va">cds_test</span><span class="op">[</span><span class="fu">rowData</span><span class="op">(</span><span class="va">cds_test</span><span class="op">)</span><span class="op">$</span><span class="va">gene_short_name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">ciliated_genes</span>,<span class="op">]</span>
<span class="va">gene_fits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/monocle3/man/fit_models.html" class="external-link">fit_models</a></span><span class="op">(</span><span class="va">cds_test_subset</span>, model_formula_str <span class="op">=</span> <span class="st">"~pseudotime_train+ batch"</span>,
                        expression_family<span class="op">=</span><span class="st">"negbinomial"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/monocle3/man/coefficient_table.html" class="external-link">coefficient_table</a></span><span class="op">(</span><span class="va">gene_fits</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">"pseudotime_train"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
         <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">gene_short_name</span>, <span class="va">term</span>, <span class="va">q_value</span>, <span class="va">estimate</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 6 × 4</span></span>
<span class="co">##   gene_short_name term              q_value estimate</span>
<span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;">1</span> ham-1           pseudotime_train 5.01<span style="color: #949494;">e</span><span style="color: #BB0000;">- 6</span> -<span style="color: #BB0000;">0.040</span><span style="color: #BB0000; text-decoration: underline;">3</span> </span>
<span class="co">## <span style="color: #BCBCBC;">2</span> dmd-6           pseudotime_train 6.61<span style="color: #949494;">e</span><span style="color: #BB0000;">-45</span>  0.146  </span>
<span class="co">## <span style="color: #BCBCBC;">3</span> hlh-17          pseudotime_train 9.27<span style="color: #949494;">e</span><span style="color: #BB0000;">- 1</span>  0.004<span style="text-decoration: underline;">62</span></span>
<span class="co">## <span style="color: #BCBCBC;">4</span> nhr-6           pseudotime_train 4.58<span style="color: #949494;">e</span><span style="color: #BB0000;">-10</span>  0.187  </span>
<span class="co">## <span style="color: #BCBCBC;">5</span> ceh-36          pseudotime_train 3.08<span style="color: #949494;">e</span><span style="color: #BB0000;">-32</span> -<span style="color: #BB0000;">0.141</span>  </span>
<span class="co">## <span style="color: #BCBCBC;">6</span> che-1           pseudotime_train 1.17<span style="color: #949494;">e</span><span style="color: #BB0000;">-12</span>  0.162</span></code></pre>
<p>The p-values are literally so tiny– even with count splitting. Huh.</p>
</div>
<div class="section level2">
<h2 id="graph-test">Graph Test<a class="anchor" aria-label="anchor" href="#graph-test"></a>
</h2>
<p>This is gonna be harder but its important.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cds_mix</span> <span class="op">&lt;-</span> <span class="va">cds_train</span>
<span class="fu"><a href="https://rdrr.io/pkg/SingleCellExperiment/man/assays.html" class="external-link">counts</a></span><span class="op">(</span><span class="va">cds_mix</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">Xtest</span>
<span class="va">ciliated_cds_pr_test_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/monocle3/man/graph_test.html" class="external-link">graph_test</a></span><span class="op">(</span><span class="va">cds_mix</span>, neighbor_graph<span class="op">=</span><span class="st">"principal_graph"</span>, cores<span class="op">=</span><span class="fl">4</span><span class="op">)</span>
<span class="va">pr_deg_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">ciliated_cds_pr_test_res</span>, <span class="va">q_value</span> <span class="op">&lt;</span> <span class="fl">0.0005</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Here are a couple of interesting genes that score as highly significant according to graph_test():</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/monocle3/man/plot_cells.html" class="external-link">plot_cells</a></span><span class="op">(</span><span class="va">cds_mix</span>, genes<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hlh-4"</span>, <span class="st">"gcy-8"</span>, <span class="st">"dac-1"</span>, <span class="st">"oig-8"</span><span class="op">)</span>,
           show_trajectory_graph<span class="op">=</span><span class="cn">FALSE</span>,
           label_cell_groups<span class="op">=</span><span class="cn">FALSE</span>,
           label_leaves<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p><img src="monocle3_tutorial_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<p>HOPEFULLY we will see that the first gene is activated before the others. That would be great. If its not something is messed up. Ok great its the same story, the only wierd thing is this REALLY big value of pseudotime that happened along one of our choices. Whoops! Will fix someday.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">AFD_genes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gcy-8"</span>, <span class="st">"dac-1"</span>, <span class="st">"oig-8"</span><span class="op">)</span>
<span class="va">AFD_lineage_cds</span> <span class="op">&lt;-</span> <span class="va">cds_mix</span><span class="op">[</span><span class="fu">rowData</span><span class="op">(</span><span class="va">cds_mix</span><span class="op">)</span><span class="op">$</span><span class="va">gene_short_name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">AFD_genes</span>,
                       <span class="fu">colData</span><span class="op">(</span><span class="va">cds_mix</span><span class="op">)</span><span class="op">$</span><span class="va">cell.type</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AFD"</span><span class="op">)</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/pkg/monocle3/man/plot_genes_in_pseudotime.html" class="external-link">plot_genes_in_pseudotime</a></span><span class="op">(</span><span class="va">AFD_lineage_cds</span>,
                         color_cells_by<span class="op">=</span><span class="st">"embryo.time.bin"</span>,
                         min_expr<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></code></pre></div>
<p><img src="monocle3_tutorial_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Anna Neufeld.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.4.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
