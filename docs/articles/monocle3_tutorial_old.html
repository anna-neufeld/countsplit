<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tutorial: countsplitting and Monocle3 OLD • countsplit</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Tutorial: countsplitting and Monocle3 OLD">
<meta property="og:description" content="countsplit">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">countsplit</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/countsplit_tutorial.html">Getting started</a>
</li>
<li>
  <a href="../articles/scran_tutorial.html">Tutorial with scran</a>
</li>
<li>
  <a href="../articles/seurat_tutorial.html">Tutorial with Seurat</a>
</li>
<li>
  <a href="../articles/monocle3_tutorial.html">Tutorial with monocle3</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/anna-neufeld/countsplit/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Tutorial: countsplitting and Monocle3 OLD</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/anna-neufeld/countsplit/blob/HEAD/vignettes/monocle3_tutorial_old.Rmd" class="external-link"><code>vignettes/monocle3_tutorial_old.Rmd</code></a></small>
      <div class="hidden name"><code>monocle3_tutorial_old.Rmd</code></div>

    </div>

    
    
<p>Before using this tutorial, we recommend that you read through our ``introduction to count splitting” tutorial to understand our method in a simple package with simulated data.</p>
<p>As in the <code>scran</code> tutorial, we use a real dataset from <span class="citation">(<strong>elorbany2022single?</strong>)</span> that is also used in our paper. The dataset contains 10,000 cells collected over 15 days of a directed differentiation protocol from induced pluripotent stem cells (IPSC) to cardiomyocytes (cm).</p>
<p>We carry out an analysis pipeline inspired by the Monocle3 <a href="https://cole-trapnell-lab.github.io/monocle3/docs/trajectories/" class="external-link">tutorial</a>, and we note that the analysis is similar to (but not idental to) the pipeline used in our paper.</p>
<!-- # Install Monocle3 -->
<!-- If you don't already have ``Monocle3``, you will need to install it. As it is in Beta, you should install it from github. Details are available at the Monocle3 [website](https://cole-trapnell-lab.github.io/monocle3/docs/installation/).  -->
<!-- Next, you should load the package, along with others that we will use in this tutorial. -->
<!-- ```{r, message=FALSE, warning=FALSE} -->
<!-- library(monocle3) -->
<!-- library(scran) -->
<!-- library(tidyverse) -->
<!-- library(countsplit) -->
<!-- ``` -->
<!-- # Preparing the data using Monocle3 -->
<!-- This data is included in this package as a ``SingleCellExperiment`` object, which is compatible with the ``scran`` package. Now that we are working with ``Monocle3``, we add a few steps to convert the data to the correct datatype. Note, however, that count splitting can occur prior to this step. -->
<!-- ```{r} -->
<!-- data(cm) -->
<!-- epsilon=0.5 -->
<!-- set.seed(1) -->
<!-- X <- t(counts(cm)) -->
<!-- Xtrain <-apply(X,2,function(u) rbinom(n=length(u), size=u, p=epsilon)) -->
<!-- rownames(Xtrain) <- rownames(X) -->
<!-- colnames(Xtrain) <- colnames(X) -->
<!-- Xtest <- X-Xtrain -->
<!-- rownames(Xtest) <- rownames(X) -->
<!-- colnames(Xtest) <- colnames(X) -->
<!-- ```` -->
<!-- Now we want to follow the preprocessing and pseudotime steps from the Monocle3 tutorial to come up with pseudotime estiamtes. -->
<!-- We want to do all of these on the training set. So we need to make a Monocle3 object! Note that the gene metadata is required!!! -->
<!-- ```{r} -->
<!-- gene_meta <- data.frame(gene_short_name = rownames(t(Xtrain))) -->
<!-- cell_meta <- colData(cm) -->
<!-- rownames(gene_meta) <- rownames(t(X)) -->
<!-- cds_train <- new_cell_data_set(t(Xtrain), -->
<!--     gene_metadata = gene_meta, -->
<!--     cell_metadata=cell_meta -->
<!-- ) -->
<!-- ``` -->
<!-- Ok! Preprocessing! We use individual as the alignmment group and we also regress out percent.mito. We could decide to regress out any metadata that we choose! -->
<!-- ```{r} -->
<!-- cds_train <- preprocess_cds(cds_train, num_dim = 50) -->
<!-- cds_train <- align_cds(cds_train, alignment_group = "individual", residual_model_formula_str = "~ percent.mito") -->
<!-- ``` -->
<!-- We see that in few dimensions, the cells cluster really nice by their true differentiation day. So we know that we are doing something reasonable even though we only used the training set.  -->
<!-- ```{r} -->
<!-- cds_train <- reduce_dimension(cds_train) -->
<!-- plot_cells(cds_train, label_groups_by_cluster=FALSE,  color_cells_by = "diffday") -->
<!-- ``` -->
<!-- Clustering the cells is a required step of the Monocle3 pipeline, so we use that here. In the paper, we really just wanted one branch. Here we will see what Monocle does my default! -->
<!-- The one difference from the tutorial is that I would like to use  -->
<!-- ```{r} -->
<!-- cds_train <- cluster_cells(cds_train) -->
<!-- cds_train <- learn_graph(cds_train, partition='F') -->
<!-- plot_cells(cds_train, color_cells_by = "diffday", -->
<!--            label_groups_by_cluster=FALSE, -->
<!--            label_leaves=FALSE, -->
<!--            label_branch_points=FALSE) -->
<!-- ``` -->
<!-- We are required to specify a starting cell. Since we know that we want the starting point of pseudotime to be on day0, we will use a day0 cell as the start.  -->
<!-- ```{r} -->
<!-- get_earliest_principal_node <- function(cds, time_bin="day0"){ -->
<!--   cell_ids <- which(colData(cds)[, "diffday"] == time_bin) -->
<!--   closest_vertex <- -->
<!--   cds@principal_graph_aux[["UMAP"]]$pr_graph_cell_proj_closest_vertex -->
<!--   closest_vertex <- as.matrix(closest_vertex[colnames(cds), ]) -->
<!--   root_pr_nodes <- -->
<!--   igraph::V(principal_graph(cds)[["UMAP"]])$name[as.numeric(names -->
<!--   (which.max(table(closest_vertex[cell_ids,]))))] -->
<!--   root_pr_nodes -->
<!-- } -->
<!-- cds_train <- order_cells(cds_train, root_pr_nodes=get_earliest_principal_node(cds_train)) -->
<!-- ``` -->
<!-- Now we are going to use Monocle3 to study differential expression along pseudotime! Using the same steps as in their tutorial! But the difference is that we will use the TEST set for fitting the models. -->
<!-- ```{r} -->
<!-- cds_test <- new_cell_data_set(t(Xtest), -->
<!--     gene_metadata = gene_meta, -->
<!--     cell_metadata=colData(cm_train) -->
<!-- ) -->
<!-- ``` -->
<!-- We need to add the training set pseudotime to the cds_test metadata. -->
<!-- ```{r} -->
<!-- colData(cds_test)$pseudotime_train <- pseudotime(cds_train) -->
<!-- ``` -->
<!-- To save some time, let's only use a random subset of genes. Maybe actually we should pick high var genes? -->
<!-- ```{r} -->
<!-- cds_test_subset <- cds_test[1:500,] -->
<!-- gene_fits <- fit_models(cds_test_subset, model_formula_str = "~pseudotime_train") -->
<!-- coefficient_table(gene_fits) %>% filter(term == "~pseudotime_train") %>% filter (q_value < 0.05) %>% -->
<!--          select(gene_short_name, term, q_value, estimate) -->
<!-- ``` -->
<!-- The table above shows the genes that we identified as differentially expressed! -->
<!-- We encourage interested readers to go check out even more options in the Monocle3 tutorials, which are very well written!  -->
<!-- ### Graph test -->
<!-- This one is harder! But we can still redo the tutorial. We just need to be smart.  -->
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Anna Neufeld.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.4.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
