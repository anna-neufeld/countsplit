covar <- (varX - varXtrain - varXtest)/2
cor <- covar / sqrt(varXtrain*varXtest)
return(cor)
}
n=10000
lambda <- 25
b=8
overdisps <- rgamma(n, b,b)
X <- rpois(n, lambda*overdisps)
ep = 0.3
bps <- 10^(seq(-log10(100000), log10(1000000), length.out=50)[-1])
cors <- rep(NA, length(bps))
c <- 1
for (bp in bps) {
Xtrain <- sapply(X,function(u) betaBinSample(u, bp, ep*bp))
Xtest <- X-Xtrain
cors[c] <-cor(Xtrain, Xtest)
c <- c+1
}
estCors <- sapply(bps, function(u) exactCorExpression(ep, lambda, b, u))
ggplot(data=NULL) +
geom_line(aes(x=bps, y=estCors, col="Closed Form"), lwd=1.5)+
geom_point( aes(x=bps, y=cors, col="Empirical sample correlation"),lwd=2)+
theme_bw()+
geom_vline(xintercept=1, col="red")+
xlab("b' (log scale)") +
ylab("Correlation(Xtrain, Xtest)")+
scale_x_log10()+
geom_hline(yintercept=0, col="red", lty=2)+
geom_hline(yintercept = sqrt(ep*(1-ep)/(ep*(1-ep)+b/lambda+b^2/lambda^2)), col="green")+
geom_hline(yintercept = (-lambda*sqrt(ep*(1-ep)))/sqrt((1+2*lambda/b+lambda^2/b^2+ep*(1-ep)*lambda^2+(lambda+lambda^2/b)))
, col="green")+
labs(col="Method")
ggplot(data=NULL) +
geom_line(aes(x=bps, y=estCors, col="Closed Form"), lwd=1.5)+
geom_point( aes(x=bps, y=cors, col="Empirical sample correlation"),lwd=2)+
theme_bw()+
geom_vline(xintercept=b, col="red")+
xlab("b' (log scale)") +
ylab("Correlation(Xtrain, Xtest)")+
scale_x_log10()+
geom_hline(yintercept=0, col="red", lty=2)+
geom_hline(yintercept = sqrt(ep*(1-ep)/(ep*(1-ep)+b/lambda+b^2/lambda^2)), col="green")+
geom_hline(yintercept = (-lambda*sqrt(ep*(1-ep)))/sqrt((1+2*lambda/b+lambda^2/b^2+ep*(1-ep)*lambda^2+(lambda+lambda^2/b)))
, col="green")+
labs(col="Method")
betaBinSample <- function(x, b,b1) {
p <- rbeta(length(x),b1,b-b1)
return(rbinom(length(x),x,p))
}
varXtrain <- function(ep, lambda, b, bprime) {
varXtrain <- lambda*ep*(1-ep)*(bprime + 1 + lambda/b + lambda)/(bprime+1)+ep^2*(lambda+lambda^2/b)
return(varXtrain)
}
varXtest <- function(ep, lambda, b, bprime) {
varXtest <- lambda*ep*(1-ep)*(bprime + 1 + lambda/b + lambda)/(bprime+1)+(1-ep)^2*(lambda+lambda^2/b)
return(varXtest)
}
exactCorExpression <- function(ep, lambda, b, bprime) {
varX <- lambda+lambda^2/b
varXtrain <- lambda*ep*(1-ep)*(bprime + 1 + lambda/b + lambda)/(bprime+1)+ep^2*(lambda+lambda^2/b)
varXtest <- lambda*ep*(1-ep)*(bprime + 1 + lambda/b + lambda)/(bprime+1)+(1-ep)^2*(lambda+lambda^2/b)
covar <- (varX - varXtrain - varXtest)/2
cor <- covar / sqrt(varXtrain*varXtest)
return(cor)
}
n=10000
lambda <- 25
b=8
overdisps <- rgamma(n, b,b)
X <- rpois(n, lambda*overdisps)
ep = 0.3
bps <- 10^(seq(-log10(100000), log10(1000000), length.out=50)[-1])
cors <- rep(NA, length(bps))
varXtrain <- rep(NA, length(bps))
varXtest <- rep(NA, length(bps))
c <- 1
for (bp in bps) {
Xtrain <- sapply(X,function(u) betaBinSample(u, bp, ep*bp))
Xtest <- X-Xtrain
cors[c] <-cor(Xtrain, Xtest)
varXtrain[c] <- var(Xtrain)
varXtest[c] <- var(Xtest)
c <- c+1
}
trueCors <- sapply(bps, function(u) exactCorExpression(ep, lambda, b, u))
trueVarXtrain <- sapply(bps, function(u) varXtrain(ep, lambda, b, u))
trueVarXtest <- sapply(bps, function(u) varXtest(ep, lambda, b, u))
varXtrain
exactvarXtrain <- function(ep, lambda, b, bprime) {
varXtrain <- lambda*ep*(1-ep)*(bprime + 1 + lambda/b + lambda)/(bprime+1)+ep^2*(lambda+lambda^2/b)
return(varXtrain)
}
exactvarXtest <- function(ep, lambda, b, bprime) {
varXtest <- lambda*ep*(1-ep)*(bprime + 1 + lambda/b + lambda)/(bprime+1)+(1-ep)^2*(lambda+lambda^2/b)
return(varXtest)
}
cors <- rep(NA, length(bps))
bps <- 10^(seq(-log10(100000), log10(1000000), length.out=50)[-1])
cors <- rep(NA, length(bps))
varXtrain <- rep(NA, length(bps))
varXtest <- rep(NA, length(bps))
c <- 1
for (bp in bps) {
Xtrain <- sapply(X,function(u) betaBinSample(u, bp, ep*bp))
Xtest <- X-Xtrain
cors[c] <-cor(Xtrain, Xtest)
varXtrain[c] <- var(Xtrain)
varXtest[c] <- var(Xtest)
c <- c+1
}
trueCors <- sapply(bps, function(u) exactCorExpression(ep, lambda, b, u))
trueVarXtrain <- sapply(bps, function(u) exactvarXtrain(ep, lambda, b, u))
trueVarXtest <- sapply(bps, function(u) exactvarXtest(ep, lambda, b, u))
p1 <- ggplot(data=NULL) +
geom_line(aes(x=bps, y=trueCors, col="Closed Form"), lwd=1.5)+
geom_point( aes(x=bps, y=cors, col="Empirical"),lwd=2)+
theme_bw()+
geom_vline(xintercept=b, col="red")+
xlab("b' (log scale)") +
ylab("Correlation(Xtrain, Xtest)")+
scale_x_log10()+
geom_hline(yintercept=0, col="red", lty=2)+
geom_hline(yintercept = sqrt(ep*(1-ep)/(ep*(1-ep)+b/lambda+b^2/lambda^2)), col="green")+
geom_hline(yintercept = (-lambda*sqrt(ep*(1-ep)))/sqrt((1+2*lambda/b+lambda^2/b^2+ep*(1-ep)*lambda^2+(lambda+lambda^2/b)))
, col="green")+
labs(col="Method")+ggtitle("Correlations")
ggplot(data=NULL) +
geom_line(aes(x=bps, y=trueVarXtrain, col="Closed Form"), lwd=1.5)+
geom_point( aes(x=bps, y=varXTrain, col="Empirical"),lwd=2)+
theme_bw()+
geom_vline(xintercept=b, col="red")+
xlab("b' (log scale)") +
ylab("Correlation(Xtrain, Xtest)")+
scale_x_log10()+
geom_hline(yintercept=0, col="red", lty=2)+
geom_hline(yintercept = sqrt(ep*(1-ep)/(ep*(1-ep)+b/lambda+b^2/lambda^2)), col="green")+
geom_hline(yintercept = (-lambda*sqrt(ep*(1-ep)))/sqrt((1+2*lambda/b+lambda^2/b^2+ep*(1-ep)*lambda^2+(lambda+lambda^2/b)))
, col="green")+
labs(col="Method")+ggtitle("Correlations")
varXtrain
gplot(data=NULL) +
geom_line(aes(x=bps, y=trueVarXtrain, col="Closed Form"), lwd=1.5)+
geom_point( aes(x=bps, y=varXtrain, col="Empirical"),lwd=2)+
theme_bw()+
geom_vline(xintercept=b, col="red")+
xlab("b' (log scale)") +
ylab("Correlation(Xtrain, Xtest)")+
scale_x_log10()+
geom_hline(yintercept=0, col="red", lty=2)+
geom_hline(yintercept = sqrt(ep*(1-ep)/(ep*(1-ep)+b/lambda+b^2/lambda^2)), col="green")+
geom_hline(yintercept = (-lambda*sqrt(ep*(1-ep)))/sqrt((1+2*lambda/b+lambda^2/b^2+ep*(1-ep)*lambda^2+(lambda+lambda^2/b)))
, col="green")+
labs(col="Method")+ggtitle("Correlations")
ggplot(data=NULL) +
geom_line(aes(x=bps, y=trueVarXtrain, col="Closed Form"), lwd=1.5)+
geom_point( aes(x=bps, y=varXtrain, col="Empirical"),lwd=2)+
theme_bw()+
geom_vline(xintercept=b, col="red")+
xlab("b' (log scale)") +
ylab("Correlation(Xtrain, Xtest)")+
scale_x_log10()+
geom_hline(yintercept=0, col="red", lty=2)+
geom_hline(yintercept = sqrt(ep*(1-ep)/(ep*(1-ep)+b/lambda+b^2/lambda^2)), col="green")+
geom_hline(yintercept = (-lambda*sqrt(ep*(1-ep)))/sqrt((1+2*lambda/b+lambda^2/b^2+ep*(1-ep)*lambda^2+(lambda+lambda^2/b)))
, col="green")+
labs(col="Method")+ggtitle("Correlations")
ggplot(data=NULL) +
geom_line(aes(x=bps, y=trueVarXtrain, col="Closed Form"), lwd=1.5)+
geom_point( aes(x=bps, y=varXtrain, col="Empirical"),lwd=2)+
theme_bw()+
geom_vline(xintercept=b, col="red")+
xlab("b' (log scale)") +
ylab("Var(Xtrain)")+
scale_x_log10()+
geom_hline(yintercept=0, col="red", lty=2)+
geom_hline(yintercept = espilon*(lambda*lambda^2/b), col="green")+
geom_hline(yintercept = (-lambda*sqrt(ep*(1-ep)))/sqrt((1+2*lambda/b+lambda^2/b^2+ep*(1-ep)*lambda^2+(lambda+lambda^2/b)))
, col="green")+
labs(col="Method")+ggtitle("Training Set Variance")
ggplot(data=NULL) +
geom_line(aes(x=bps, y=trueVarXtrain, col="Closed Form"), lwd=1.5)+
geom_point( aes(x=bps, y=varXtrain, col="Empirical"),lwd=2)+
theme_bw()+
geom_vline(xintercept=b, col="red")+
xlab("b' (log scale)") +
ylab("Var(Xtrain)")+
scale_x_log10()+
geom_hline(yintercept=0, col="red", lty=2)+
geom_hline(yintercept = ep*(lambda*lambda^2/b), col="green")+
geom_hline(yintercept = (-lambda*sqrt(ep*(1-ep)))/sqrt((1+2*lambda/b+lambda^2/b^2+ep*(1-ep)*lambda^2+(lambda+lambda^2/b)))
, col="green")+
labs(col="Method")+ggtitle("Training Set Variance")
ggplot(data=NULL) +
geom_line(aes(x=bps, y=trueVarXtrain, col="Closed Form"), lwd=1.5)+
geom_point( aes(x=bps, y=varXtrain, col="Empirical"),lwd=2)+
theme_bw()+
geom_vline(xintercept=b, col="red")+
xlab("b' (log scale)") +
ylab("Var(Xtrain)")+
scale_x_log10()+
geom_hline(yintercept=0, col="red", lty=2)+
geom_hline(yintercept = ep*(lambda+lambda^2/b), col="green")+
geom_hline(yintercept = (-lambda*sqrt(ep*(1-ep)))/sqrt((1+2*lambda/b+lambda^2/b^2+ep*(1-ep)*lambda^2+(lambda+lambda^2/b)))
, col="green")+
labs(col="Method")+ggtitle("Training Set Variance")
p1 <- ggplot(data=NULL) +
geom_line(aes(x=bps, y=trueCors, col="Closed Form"), lwd=1.5)+
geom_point( aes(x=bps, y=cors, col="Empirical"),lwd=2)+
theme_bw()+
geom_vline(xintercept=b, col="red")+
xlab("b' (log scale)") +
ylab("Correlation(Xtrain, Xtest)")+
scale_x_log10()+
geom_hline(yintercept=0, col="green")+
geom_hline(yintercept = sqrt(ep*(1-ep)/(ep*(1-ep)+b/lambda+b^2/lambda^2)), col="green")+
geom_hline(col="green", yintercept = (-lambda*sqrt(ep*(1-ep)))/sqrt((1+2*lambda/b+lambda^2/b^2+ep*(1-ep)*lambda^2+(lambda+lambda^2/b)))
, col="green")+
labs(col="Method")+ggtitle("Correlations")
p1 <- ggplot(data=NULL) +
geom_line(aes(x=bps, y=trueCors, col="Closed Form"), lwd=1.5)+
geom_point( aes(x=bps, y=cors, col="Empirical"),lwd=2)+
theme_bw()+
geom_vline(xintercept=b, col="red")+
xlab("b' (log scale)") +
ylab("Correlation(Xtrain, Xtest)")+
scale_x_log10()+
geom_hline(yintercept=0, col="green")+
geom_hline(yintercept = sqrt(ep*(1-ep)/(ep*(1-ep)+b/lambda+b^2/lambda^2)), col="green")+
geom_hline(col="green", yintercept = (-lambda*sqrt(ep*(1-ep)))/sqrt((1+2*lambda/b+lambda^2/b^2+ep*(1-ep)*lambda^2+(lambda+lambda^2/b)))
, col="green")+
labs(col="Method")+ggtitle("Correlations")
p2 <- ggplot(data=NULL) +
geom_line(aes(x=bps, y=trueVarXtrain, col="Closed Form"), lwd=1.5)+
geom_point( aes(x=bps, y=varXtrain, col="Empirical"),lwd=2)+
theme_bw()+
geom_vline(xintercept=b, col="red")+
xlab("b' (log scale)") +
ylab("Var(Xtrain)")+
scale_x_log10()+
geom_hline(yintercept=0, col="red", lty=2)+
geom_hline(yintercept = ep*(lambda+lambda^2/b), col="green")+
geom_hline(yintercept = (-lambda*sqrt(ep*(1-ep)))/sqrt((1+2*lambda/b+lambda^2/b^2+ep*(1-ep)*lambda^2+(lambda+lambda^2/b)))
, col="green")+
labs(col="Method")+ggtitle("Training Set Variance")
p3 <- ggplot(data=NULL) +
geom_line(aes(x=bps, y=trueVarXtest, col="Closed Form"), lwd=1.5)+
geom_point( aes(x=bps, y=varXtest, col="Empirical"),lwd=2)+
theme_bw()+
geom_vline(xintercept=b, col="red")+
xlab("b' (log scale)") +
ylab("Var(Xtest)")+
scale_x_log10()+
geom_hline(yintercept=0, col="red", lty=2)+
geom_hline(yintercept = sqrt(ep*(1-ep)/(ep*(1-ep)+b/lambda+b^2/lambda^2)), col="green")+
geom_hline(yintercept = (-lambda*sqrt(ep*(1-ep)))/sqrt((1+2*lambda/b+lambda^2/b^2+ep*(1-ep)*lambda^2+(lambda+lambda^2/b)))
, col="green")+
labs(col="Method")+ggtitle("Correlations")
library(patchwork)
p1+p2+p3+plot_layout(guides="collect")
p1 <- ggplot(data=NULL) +
geom_line(aes(x=bps, y=trueCors, col="Closed Form"), lwd=1.5)+
geom_point( aes(x=bps, y=cors, col="Empirical"),lwd=2)+
theme_bw()+
geom_vline(xintercept=b, col="red")+
xlab("b' (log scale)") +
ylab("Correlation(Xtrain, Xtest)")+
scale_x_log10()+
geom_hline(yintercept=0, col="green")+
geom_hline(yintercept = sqrt(ep*(1-ep)/(ep*(1-ep)+b/lambda+b^2/lambda^2)), col="green")+
geom_hline(col="green", yintercept = (-lambda*sqrt(ep*(1-ep)))/sqrt((1+2*lambda/b+lambda^2/b^2+ep*(1-ep)*lambda^2+(lambda+lambda^2/b)))
, col="green")+
labs(col="")+ggtitle("Correlations")
p2 <- ggplot(data=NULL) +
geom_line(aes(x=bps, y=trueVarXtrain, col="Closed Form"), lwd=1.5)+
geom_point( aes(x=bps, y=varXtrain, col="Empirical"),lwd=2)+
theme_bw()+
geom_vline(xintercept=b, col="red")+
xlab("b' (log scale)") +
ylab("Var(Xtrain)")+
scale_x_log10()+
geom_hline(yintercept=0, col="red", lty=2)+
geom_hline(yintercept = ep*(lambda+lambda^2/b), col="green")+
geom_hline(yintercept = (-lambda*sqrt(ep*(1-ep)))/sqrt((1+2*lambda/b+lambda^2/b^2+ep*(1-ep)*lambda^2+(lambda+lambda^2/b)))
, col="green")+
labs(col="")+ggtitle("Training set variance")
p3 <- ggplot(data=NULL) +
geom_line(aes(x=bps, y=trueVarXtest, col="Closed Form"), lwd=1.5)+
geom_point( aes(x=bps, y=varXtest, col="Empirical"),lwd=2)+
theme_bw()+
geom_vline(xintercept=b, col="red")+
xlab("b' (log scale)") +
ylab("Var(Xtest)")+
scale_x_log10()+
geom_hline(yintercept=0, col="red", lty=2)+
geom_hline(yintercept = sqrt(ep*(1-ep)/(ep*(1-ep)+b/lambda+b^2/lambda^2)), col="green")+
geom_hline(yintercept = (-lambda*sqrt(ep*(1-ep)))/sqrt((1+2*lambda/b+lambda^2/b^2+ep*(1-ep)*lambda^2+(lambda+lambda^2/b)))
, col="green")+
labs(col="")+ggtitle("Test set variance")
library(patchwork)
p1+p2+p3+plot_layout(guides="collect")
p1 <- ggplot(data=NULL) +
geom_line(aes(x=bps, y=trueCors, col="Closed Form"), lwd=1.5)+
geom_point( aes(x=bps, y=cors, col="Empirical"),lwd=2)+
theme_bw()+
geom_vline(xintercept=b, col="red")+
xlab("b' (log scale)") +
ylab("Correlation(Xtrain, Xtest)")+
scale_x_log10()+
geom_hline(yintercept=0, col="green")+
geom_hline(yintercept = sqrt(ep*(1-ep)/(ep*(1-ep)+b/lambda+b^2/lambda^2)), col="green")+
geom_hline(col="green", yintercept = (-lambda*sqrt(ep*(1-ep)))/sqrt((1+2*lambda/b+lambda^2/b^2+ep*(1-ep)*lambda^2+(lambda+lambda^2/b)))
, col="green")+
labs(col="")+ggtitle("Correlations")
p2 <- ggplot(data=NULL) +
geom_line(aes(x=bps, y=trueVarXtrain, col="Closed Form"), lwd=1.5)+
geom_point( aes(x=bps, y=varXtrain, col="Empirical"),lwd=2)+
theme_bw()+
geom_vline(xintercept=b, col="red")+
xlab("b' (log scale)") +
ylab("Var(Xtrain)")+
scale_x_log10()+
geom_hline(yintercept=ep*(lambda+lambda^2/b) + ep*(1-ep)*lambda^2, col="red", lty=2)+
geom_hline(yintercept = ep*(lambda+lambda^2/b), col="green")+
geom_hline(yintercept = (-lambda*sqrt(ep*(1-ep)))/sqrt((1+2*lambda/b+lambda^2/b^2+ep*(1-ep)*lambda^2+(lambda+lambda^2/b)))
, col="green")+
labs(col="")+ggtitle("Training set variance")
p3 <- ggplot(data=NULL) +
geom_line(aes(x=bps, y=trueVarXtest, col="Closed Form"), lwd=1.5)+
geom_point( aes(x=bps, y=varXtest, col="Empirical"),lwd=2)+
theme_bw()+
geom_vline(xintercept=b, col="red")+
xlab("b' (log scale)") +
ylab("Var(Xtest)")+
scale_x_log10()+
geom_hline(yintercept=(1-ep)*(lambda+lambda^2/b) + ep*(1-ep)*lambda^2, col="red", lty=2)+
geom_hline(yintercept = (1-ep)*(lambda+lambda^2/b), col="green")+
geom_hline(yintercept = (-lambda*sqrt(ep*(1-ep)))/sqrt((1+2*lambda/b+lambda^2/b^2+ep*(1-ep)*lambda^2+(lambda+lambda^2/b)))
, col="green")+
labs(col="")+ggtitle("Test set variance")
library(patchwork)
p1+p2+p3+plot_layout(guides="collect")
p1 <- ggplot(data=NULL) +
geom_line(aes(x=bps, y=trueCors, col="Closed Form"), lwd=1.5)+
geom_point( aes(x=bps, y=cors, col="Empirical"),lwd=2)+
theme_bw()+
geom_vline(xintercept=b, col="red")+
xlab("b' (log scale)") +
ylab("Correlation(Xtrain, Xtest)")+
scale_x_log10()+
geom_hline(yintercept=0, col="green")+
geom_hline(yintercept = sqrt(ep*(1-ep)/(ep*(1-ep)+b/lambda+b^2/lambda^2)), col="green")+
geom_hline(col="green", yintercept = (-lambda*sqrt(ep*(1-ep)))/sqrt((1+2*lambda/b+lambda^2/b^2+ep*(1-ep)*lambda^2+(lambda+lambda^2/b)))
, col="green")+
labs(col="")+ggtitle("Correlations")
p2 <- ggplot(data=NULL) +
geom_line(aes(x=bps, y=trueVarXtrain, col="Closed Form"), lwd=1.5)+
geom_point( aes(x=bps, y=varXtrain, col="Empirical"),lwd=2)+
theme_bw()+
geom_vline(xintercept=b, col="red")+
xlab("b' (log scale)") +
ylab("Var(Xtrain)")+
scale_x_log10()+
geom_hline(yintercept=ep*(lambda+lambda^2/b) + ep*(1-ep)*lambda^2, col="green")+
geom_hline(yintercept = ep*(lambda+lambda^2/b), col="green")+
geom_hline(yintercept = (-lambda*sqrt(ep*(1-ep)))/sqrt((1+2*lambda/b+lambda^2/b^2+ep*(1-ep)*lambda^2+(lambda+lambda^2/b)))
, col="green")+
labs(col="")+ggtitle("Training set variance")
p3 <- ggplot(data=NULL) +
geom_line(aes(x=bps, y=trueVarXtest, col="Closed Form"), lwd=1.5)+
geom_point( aes(x=bps, y=varXtest, col="Empirical"),lwd=2)+
theme_bw()+
geom_vline(xintercept=b, col="red")+
xlab("b' (log scale)") +
ylab("Var(Xtest)")+
scale_x_log10()+
geom_hline(yintercept=(1-ep)*(lambda+lambda^2/b) + ep*(1-ep)*lambda^2, col="green")+
geom_hline(yintercept = (1-ep)*(lambda+lambda^2/b), col="green")+
geom_hline(yintercept = (-lambda*sqrt(ep*(1-ep)))/sqrt((1+2*lambda/b+lambda^2/b^2+ep*(1-ep)*lambda^2+(lambda+lambda^2/b)))
, col="green")+
labs(col="")+ggtitle("Test set variance")
library(patchwork)
p1+p2+p3+plot_layout(guides="collect")
p1 <- ggplot(data=NULL) +
geom_line(aes(x=bps, y=trueCors, col="Closed Form"), lwd=1.5)+
geom_point( aes(x=bps, y=cors, col="Empirical"),lwd=2)+
theme_bw()+
geom_vline(xintercept=b, col="red")+
xlab("b' (log scale)") +
ylab("Correlation(Xtrain, Xtest)")+
scale_x_log10()+
geom_hline(yintercept=0, col="green")+
geom_hline(yintercept = sqrt(ep*(1-ep)/(ep*(1-ep)+b/lambda+b^2/lambda^2)), col="green")+
geom_hline(col="green", yintercept = (-lambda*sqrt(ep*(1-ep)))/sqrt((1+2*lambda/b+lambda^2/b^2+ep*(1-ep)*lambda^2+(lambda+lambda^2/b)))
, col="green")+
labs(col="")+ggtitle("Correlations")
p2 <- ggplot(data=NULL) +
geom_line(aes(x=bps, y=trueVarXtrain, col="Closed Form"), lwd=1.5)+
geom_point( aes(x=bps, y=varXtrain, col="Empirical"),lwd=2)+
theme_bw()+
geom_vline(xintercept=b, col="red")+
xlab("b' (log scale)") +
ylab("Var(Xtrain)")+
scale_x_log10()+
geom_hline(yintercept=ep*(lambda+lambda^2/b) + ep*(1-ep)*lambda^2, col="green")+
geom_hline(yintercept = ep*(lambda+lambda^2/b), col="green")+
geom_hline(yintercept = ep*(lambda+ep*lambda^2/b)
, col="green")+
labs(col="")+ggtitle("Training set variance")
p3 <- ggplot(data=NULL) +
geom_line(aes(x=bps, y=trueVarXtest, col="Closed Form"), lwd=1.5)+
geom_point( aes(x=bps, y=varXtest, col="Empirical"),lwd=2)+
theme_bw()+
geom_vline(xintercept=b, col="red")+
xlab("b' (log scale)") +
ylab("Var(Xtest)")+
scale_x_log10()+
geom_hline(yintercept=(1-ep)*(lambda+lambda^2/b) + ep*(1-ep)*lambda^2, col="green")+
geom_hline(yintercept = (1-ep)*(lambda+lambda^2/b), col="green")+
geom_hline(yintercept = (1-ep)*(lambda+(1-ep)*lambda^2/b)
, col="green")+
labs(col="")+ggtitle("Test set variance")
library(patchwork)
p1+p2+p3+plot_layout(guides="collect")
ggsave("~/Dropbox/Overdispersion Project/cor_plot_ex.png")
ggsave("~/Dropbox/Overdispersion Project/cor_plot_ex.png")
betaBinSample <- function(x, b,b1) {
p <- rbeta(length(x),b1,b-b1)
return(rbinom(length(x),x,p))
}
exactvarXtrain <- function(ep, lambda, b, bprime) {
varXtrain <- lambda*ep*(1-ep)*(bprime + 1 + lambda/b + lambda)/(bprime+1)+ep^2*(lambda+lambda^2/b)
return(varXtrain)
}
exactvarXtest <- function(ep, lambda, b, bprime) {
varXtest <- lambda*ep*(1-ep)*(bprime + 1 + lambda/b + lambda)/(bprime+1)+(1-ep)^2*(lambda+lambda^2/b)
return(varXtest)
}
exactCorExpression <- function(ep, lambda, b, bprime) {
varX <- lambda+lambda^2/b
varXtrain <- lambda*ep*(1-ep)*(bprime + 1 + lambda/b + lambda)/(bprime+1)+ep^2*(lambda+lambda^2/b)
varXtest <- lambda*ep*(1-ep)*(bprime + 1 + lambda/b + lambda)/(bprime+1)+(1-ep)^2*(lambda+lambda^2/b)
covar <- (varX - varXtrain - varXtest)/2
cor <- covar / sqrt(varXtrain*varXtest)
return(cor)
}
n=100000
lambda <- 25
b=8
overdisps <- rgamma(n, b,b)
X <- rpois(n, lambda*overdisps)
ep = 0.3
bps <- 10^(seq(-log10(100000), log10(1000000), length.out=50)[-1])
cors <- rep(NA, length(bps))
varXtrain <- rep(NA, length(bps))
varXtest <- rep(NA, length(bps))
c <- 1
for (bp in bps) {
Xtrain <- sapply(X,function(u) betaBinSample(u, bp, ep*bp))
Xtest <- X-Xtrain
cors[c] <-cor(Xtrain, Xtest)
varXtrain[c] <- var(Xtrain)
varXtest[c] <- var(Xtest)
c <- c+1
}
trueCors <- sapply(bps, function(u) exactCorExpression(ep, lambda, b, u))
trueVarXtrain <- sapply(bps, function(u) exactvarXtrain(ep, lambda, b, u))
trueVarXtest <- sapply(bps, function(u) exactvarXtest(ep, lambda, b, u))
p1 <- ggplot(data=NULL) +
geom_line(aes(x=bps, y=trueCors, col="Closed Form"), lwd=1.5)+
geom_point( aes(x=bps, y=cors, col="Empirical"),lwd=2)+
theme_bw()+
geom_vline(xintercept=b, col="red")+
xlab("b' (log scale)") +
ylab("Correlation(Xtrain, Xtest)")+
scale_x_log10()+
geom_hline(yintercept=0, col="green")+
geom_hline(yintercept = sqrt(ep*(1-ep)/(ep*(1-ep)+b/lambda+b^2/lambda^2)), col="green")+
geom_hline(col="green", yintercept = (-lambda*sqrt(ep*(1-ep)))/sqrt((1+2*lambda/b+lambda^2/b^2+ep*(1-ep)*lambda^2+(lambda+lambda^2/b)))
, col="green")+
labs(col="")+ggtitle("Correlations")
p2 <- ggplot(data=NULL) +
geom_line(aes(x=bps, y=trueVarXtrain, col="Closed Form"), lwd=1.5)+
geom_point( aes(x=bps, y=varXtrain, col="Empirical"),lwd=2)+
theme_bw()+
geom_vline(xintercept=b, col="red")+
xlab("b' (log scale)") +
ylab("Var(Xtrain)")+
scale_x_log10()+
geom_hline(yintercept=ep*(lambda+lambda^2/b) + ep*(1-ep)*lambda^2, col="green")+
geom_hline(yintercept = ep*(lambda+lambda^2/b), col="green")+
geom_hline(yintercept = ep*(lambda+ep*lambda^2/b)
, col="green")+
labs(col="")+ggtitle("Training set variance")
p3 <- ggplot(data=NULL) +
geom_line(aes(x=bps, y=trueVarXtest, col="Closed Form"), lwd=1.5)+
geom_point( aes(x=bps, y=varXtest, col="Empirical"),lwd=2)+
theme_bw()+
geom_vline(xintercept=b, col="red")+
xlab("b' (log scale)") +
ylab("Var(Xtest)")+
scale_x_log10()+
geom_hline(yintercept=(1-ep)*(lambda+lambda^2/b) + ep*(1-ep)*lambda^2, col="green")+
geom_hline(yintercept = (1-ep)*(lambda+lambda^2/b), col="green")+
geom_hline(yintercept = (1-ep)*(lambda+(1-ep)*lambda^2/b)
, col="green")+
labs(col="")+ggtitle("Test set variance")
library(patchwork)
p1+p2+p3+plot_layout(guides="collect")
ggsave("~/Dropbox/Overdispersion Project/cor_plot_ex.png")
setwd("~/countsplit")
devtools::build_site(lazy=TRUE)
